{% extends 'base.html.twig' %}

{% block title %}Nouvelle Requête - MAESTRO{% endblock %}

{% block body %}
<div class="row justify-content-center">
    <div class="col-lg-8">
        <div class="card border-0 shadow-sm">
            <div class="card-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                <h4 class="mb-0 text-white">
                    ➕ Nouvelle Requête d'Analyse
                </h4>
                <small class="text-white-50">Projet: {{ project_name }}</small>
            </div>
            <div class="card-body">
                <p class="text-muted mb-4">
                    Décrivez votre besoin ci-dessous. Les agents IA MAESTRO (PM, Cadrage, US, Dev, Test, Deploy)
                    vont analyser votre requête et vous fournir une estimation complète.
                </p>

                <form method="post">
                    <div class="mb-4">
                        <label for="title" class="form-label fw-bold">Titre de la requête *</label>
                        <input type="text" class="form-control form-control-lg" id="title" name="title"
                               value="{{ title|default('') }}" required
                               placeholder="Ex: Créer une API REST pour la gestion des utilisateurs">
                        <small class="form-text text-muted">Un titre court et descriptif</small>
                    </div>

                    <div class="mb-4">
                        <label for="description" class="form-label fw-bold">Description détaillée *</label>
                        <textarea class="form-control" id="description" name="description" rows="8" required
                                  placeholder="Décrivez en détail votre besoin :&#10;- Fonctionnalités attendues&#10;- Contraintes techniques&#10;- Cas d'usage&#10;- Technologies préférées&#10;- Etc.">{{ description|default('') }}</textarea>
                        <small class="form-text text-muted">Plus la description est détaillée, plus l'analyse sera précise</small>
                    </div>

                    <div class="row mb-4">
                        <div class="col-md-6">
                            <label for="type" class="form-label fw-bold">Type de requête</label>
                            <select class="form-select" id="type" name="type">
                                <option value="FEATURE" {{ type|default('') == 'FEATURE' ? 'selected' : '' }}>✨ Nouvelle fonctionnalité</option>
                                <option value="BUG" {{ type|default('') == 'BUG' ? 'selected' : '' }}>🐛 Correction de bug</option>
                                <option value="ENHANCEMENT" {{ type|default('') == 'ENHANCEMENT' ? 'selected' : '' }}>⚡ Amélioration</option>
                                <option value="REFACTORING" {{ type|default('') == 'REFACTORING' ? 'selected' : '' }}>🔄 Refactoring</option>
                                <option value="DOCUMENTATION" {{ type|default('') == 'DOCUMENTATION' ? 'selected' : '' }}>📚 Documentation</option>
                            </select>
                        </div>

                        <div class="col-md-6">
                            <label for="priority" class="form-label fw-bold">Priorité</label>
                            <select class="form-select" id="priority" name="priority">
                                <option value="LOW" {{ priority|default('') == 'LOW' ? 'selected' : '' }}>🟢 Basse</option>
                                <option value="MEDIUM" {{ priority|default('MEDIUM') == 'MEDIUM' ? 'selected' : '' }}>🔵 Moyenne</option>
                                <option value="HIGH" {{ priority|default('') == 'HIGH' ? 'selected' : '' }}>🟡 Haute</option>
                                <option value="CRITICAL" {{ priority|default('') == 'CRITICAL' ? 'selected' : '' }}>🔴 Critique</option>
                            </select>
                        </div>
                    </div>

                    <div class="alert alert-info">
                        <strong>ℹ️ Comment ça marche ?</strong><br>
                        1. Votre requête est envoyée au workflow n8n<br>
                        2. L'agent PM analyse et évalue la complexité<br>
                        3. L'agent Cadrage définit l'architecture<br>
                        4. L'agent US génère les user stories<br>
                        5. Vous recevez une estimation complète !
                    </div>

                    <div class="d-flex justify-content-between align-items-center">
                        <a href="{{ path('app_project_dashboard', {slug: app.session.get('current_project_slug')}) }}" class="btn btn-outline-secondary">
                            ← Annuler
                        </a>
                        <button type="submit" class="btn btn-primary btn-lg">
                            🚀 Lancer l'Analyse
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}
